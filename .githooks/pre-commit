#!/bin/sh
# Block commit if staged files contain secret-like content.
# Install once: git config core.hooksPath .githooks

STAGED=$(git diff --cached --name-only)
for file in $STAGED; do
  case "$file" in .env|.env.*) continue ;; esac
  if git diff --cached -- "$file" | grep -qE 'sk-proj-[a-zA-Z0-9]{20,}|["\x27]sk-[a-zA-Z0-9]{30,}'; then
    echo "error: Possible API key detected in: $file"
    echo "Secrets belong in .env (gitignored) or EAS env, not in committed files."
    exit 1
  fi
done
exit 0
